{% extends "template.html" %}
{% import 'bootstrap/wtf.html' as wtf %}
{% from "_macros.html" import render_field_with_errors, render_field %}

{% block header %}
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
{% endblock %}

{% block app_content %}
    <div class="col-lg-2 class-padding">
        <h1>Input Form</h1>
        <form action="" method="post" class="form" role="form">
            {{ form.csrf_token }}

            {#            {{ wtf.form_field(form.num) }}#}
            <div class="form-group  required">
                <label class="control-label" for="num">{{ form.num.label.text }}</label>
                <input
                        class="form-control" id="num" name="num"
                        required="" type="number" value="{{ form.num.data }}"
                        onblur="location.reload(true)">
            </div>

            {{ wtf.form_field(form.steps) }}

            <div class="card mb-4">
                <div class="card-header">
                    {{ form.label }}
                </div>
                <div class="card-body">
                    {{ render_field_with_errors(form.algs, ri="multicheckbox") }}
                </div>
            </div>

            <ul class="nav nav-tabs">
                {% for choice in form.ALGORITMS %}
                    <li class="nav-item">
                        <a class="nav-link {% if loop.index == 1 %} active {% endif %}" data-toggle="pill"
                           href="#{{ choice }}">{{ choice }}</a>
                    </li>
                {% endfor %}
            </ul>
            <div class="tab-content">
                {% for choice in form.ALGORITMS %}
                    <div class="tab-pane fade in {% if loop.index == 1 %} active {% endif %}" id="{{ choice }}">
                        {% for param in form.ALGO_PARAMETERS[choice] %}
                            {{ wtf.form_field(form[choice + "_" + param]) }}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

            {{ wtf.form_field(form.submit) }}
        </form>
    </div>


    <div class="col-lg-9 class-padding pull-right">
        {% set matrix_label=matrix.matrix.label.text %}
        {% set active_flag = True %}
        {#  Create tab for matrix#}
        <ul class="nav nav-tabs">
            {% set clazz="" %}
            {% if form.num.data %}
                {% set clazz="active" %}
                {% set active_flag = False %}
            {% else %}
                {% set clazz="disabled" %}
            {% endif %}
            <li class="nav-item {{ clazz }}">
                <a class="nav-link" data-toggle="pill"
                   href="#{{ matrix_label }}">{{ matrix_label }}</a>
            </li>


            {% set names = ["LVP_Dynamic", "ALVP_Dynamic", "Error_comparison"] %}
            {% for name in names %}
                {% set clazz="" %}
                {% if name in plots and active_flag %}
                    {% set clazz="active" %}
                    {% set active_flag = False %}
                {% elif not name in plots %}
                    {% set clazz="disabled" %}
                {% endif %}
                <li class="nav-item {{ clazz }}">
                    <a class="nav-link" data-toggle="pill"
                       href="#{{ names[loop.index - 1] }}">{{ names[loop.index - 1] }}</a>
                </li>
            {% endfor %}
        </ul>

        {# Create tab with matrix to fill in #}
        <div class="tab-content">
            {% set active_flag = True %}
            {% if form.num.data %}
                {% set clazz="active" %}
                {% set active_flag = False %}
            {% else %}
                {% set clazz="disabled" %}
            {% endif %}
            <div class="tab-pane fade in {{ clazz }} margin-down" id="{{ matrix_label }}">
                {% for row in matrix.matrix %}
                    <div class="row">
                        {% for cell in row.field %}
                            {% set row_num=loop.index %}
                            <div class="col-sm-1 form-group">
                                <input class="form-control"
                                       id="matrix-{{ loop.index }}-{{ row_num }}"
                                       name="matrix-{{ loop.index }}-{{ row_num }}"
                                       type="text"
                                       value="{{ cell.data }}">
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>

            {% set clazz="" %}
            {% if name in plots and active_flag %}
                {% set clazz="active" %}
                {% set active_flag = False %}
            {% elif not name in plots %}
                {% set clazz="disabled" %}
            {% endif %}
            {% for name in names %}
                {% if name in plots %}
                    <div class="tab-pane fade in {{ clazz }} margin-down"
                         id="{{ names[loop.index - 1] }}">
                        {{ plots[name] | safe }}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endblock %}